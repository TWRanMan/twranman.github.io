---
layout: post
title:  "XCodeGhost随想"
date:   2015-09-19 16:50:21
categories: jekyll update
---
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<style>
h1,
h2,
h3,
h4,
h5,
h6,
p,
blockquote {
    margin: 0;
    padding: 0;
}
body {
    font-family: "Helvetica Neue", Helvetica, "Hiragino Sans GB", Arial, sans-serif;
    font-size: 13px;
    line-height: 18px;
    color: #737373;
    background-color: white;
    margin: 10px 13px 10px 13px;
}
table {
	margin: 10px 0 15px 0;
	border-collapse: collapse;
}
td,th {	
	border: 1px solid #ddd;
	padding: 3px 10px;
}
th {
	padding: 5px 10px;	
}

a {
    color: #0069d6;
}
a:hover {
    color: #0050a3;
    text-decoration: none;
}
a img {
    border: none;
}
p {
    margin-bottom: 9px;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    color: #404040;
    line-height: 36px;
}
h1 {
    margin-bottom: 18px;
    font-size: 30px;
}
h2 {
    font-size: 24px;
}
h3 {
    font-size: 18px;
}
h4 {
    font-size: 16px;
}
h5 {
    font-size: 14px;
}
h6 {
    font-size: 13px;
}
hr {
    margin: 0 0 19px;
    border: 0;
    border-bottom: 1px solid #ccc;
}
blockquote {
    padding: 13px 13px 21px 15px;
    margin-bottom: 18px;
    font-family:georgia,serif;
    font-style: italic;
}
blockquote:before {
    content:"\201C";
    font-size:40px;
    margin-left:-10px;
    font-family:georgia,serif;
    color:#eee;
}
blockquote p {
    font-size: 14px;
    font-weight: 300;
    line-height: 18px;
    margin-bottom: 0;
    font-style: italic;
}
code, pre {
    font-family: Monaco, Andale Mono, Courier New, monospace;
}
code {
    background-color: #fee9cc;
    color: rgba(0, 0, 0, 0.75);
    padding: 1px 3px;
    font-size: 12px;
    -webkit-border-radius: 3px;
    -moz-border-radius: 3px;
    border-radius: 3px;
}
pre {
    display: block;
    padding: 14px;
    margin: 0 0 18px;
    line-height: 16px;
    font-size: 11px;
    border: 1px solid #d9d9d9;
    white-space: pre-wrap;
    word-wrap: break-word;
}
pre code {
    background-color: #fff;
    color:#737373;
    font-size: 11px;
    padding: 0;
}
sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}
* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:10px auto;
    }
}
@media print {
	body,code,pre code,h1,h2,h3,h4,h5,h6 {
		color: black;
	}
	table, pre {
		page-break-inside: avoid;
	}
}
</style>
<title>昨天一条XCodeGhost的消息在微信朋友圈和IT圈炸开了</title>

</head>
<body>
<p>昨天一条XCodeGhost的消息在微信朋友圈和IT圈炸开了锅，并且应发了许多人的愤怒和担忧，愤怒中国这么多知名IT公司的不负责，担忧的是自己的用户名密码等隐私信息的再一次都是会给自己带来又一次的伤害。
简单说XCodeGhost是有人在XCode里面植入了一段代码，导致用户使用这个XCode编译的APP时会自动执行这段代码，将用户的隐私信息发往黑客的服务器，详细信息参见乌云：http://drops.wooyun.org/news/8864。截至今天已经有超过20款iOS应用确认拥有XCodeGhost。
当我看到这个新闻的时候，第一个想法就是"历史总是如此的相似"。让我们回到上个世纪70，80年代，Unix之父Ken Thompson（1943～）在贝尔实验室里面开发了Unix系统，并且贝尔实验室的计算机也安装了这个Unix系统供员工使用。有一天大家发现Ken总是可以以最高权限进入他们的帐号。可想而知，在牛人聚集的贝尔实验室是不允许这样的事情的，所以许多员工跳出来仔细分析Unix代码，并且确实也找到了后门，然后修复这些后门后重新编译整个Unix并重新安装。所有人都以为可以放心的使用新的Unix的时候却发现Ken还是可以自由的获取他们的账户权限，并且再也无能为力了。直到多年以后，Ken才解开了大家心中的疑惑，原来Ken在编译Unix所使用的C语言编译器里面加入了后门，而当时跳出来分析和修复Unix的员工并没有去分析过C语言编译器，导致Ken一再得手。回想昨天的新闻，竟是如此的相似。
相对于Ken在C语言编译器植入后门，XCodeGhost在XCode里面植入后门只能算小儿科（因为当时贝尔实验室使用的C语言编译器是Ken开发的，相当于官方发布了具有后门的编译器），毕竟官方的XCode并没有包含XCodeGhost。那么为什么还是有如此多的知名IT公司的iOS应用都感染的此病毒啦?其中有一个传言就是由于从中国去Apple官服下载XCode非常慢，所以需要去各个社区或者通过迅雷下载，所以才导致下载到了包含XCodeGhost的XCode。我觉得迅雷纯属躺枪，开发者使用了不安全的工作方法，还要找个借口发泄到迅雷身上，这本身就是一种不负责的态度。
对于XCodeGhost的爆发，我有一些疑惑：</p>

<ul>
<li>这些公司的软件发布流程是怎么样的？是通过CI（持续集成）统一构建发布，还是随便找一个开发人员，从其开发机上构建发布?</li>
<li>如果是使用CI统一发布，难道CI配置也是随便配置，没有任何规范流程?</li>
</ul>


<p>我认为良好的CI环境是预防XCodeGhost这样的漏洞最好方法，因此我们应该做到：</p>

<ul>
<li>软件的发布版本一定要通过CI构建获得，并且CI的构建所使用到的软件一定要从官方渠道获得。</li>
<li>代码版本库里面最好只有源代码，如果需要包含依赖库，这个依赖库也只能通过CI构建，而不是在某个开发的机器上构建获得。</li>
</ul>


<p>其次：</p>

<ul>
<li>公司应该规定开发使用的软件都应该从官方渠道获取，并要求对于下载的软件进行MD5或者SHA-1哈希值验证。</li>
<li>如果开发人员过多，不方便管理，可以要求IT统一从官方驱动获取软件，然后由IT统一管理和安装所有软件。</li>
</ul>


<p>扩展随想，编译器/IDE以后我们注意了，第三方包/框架我们就可以放心了吗？这些第三方包就不会有类似XCodeGhost的后门?针对这个我有一些想法：</p>

<ul>
<li>尽量使用在线包管理系统下载第三方包，现在基本上大部分的语言都有其第三方包在线管理方案，java有maven，ruby有gems，nodejs有npm，iOS有Alcatraz和CocoaPods等等。并且在使用前尽量通过这些在线包管理系统多了解一下你将使用的包，比如多少人使用，有些评论，有些bugs，当时这还是不够的。</li>
<li>在CVE,NVD,乌云等这类安全漏洞网站上查询你是用的第三方包是否存在漏洞。如果你觉得手动麻烦，还可以使用<a href="https://www.owasp.org/index.php/OWASP_Dependency_Check">OWASP Dependency Check</a>来自动扫描你将使用的第三方库，从而及早发现其漏洞，详细使用方法参见<a href="http://www.infoq.com/cn/articles/WebScan-CI">在CI中实现持续Web安全扫描</a></li>
</ul>

</body>
</html>