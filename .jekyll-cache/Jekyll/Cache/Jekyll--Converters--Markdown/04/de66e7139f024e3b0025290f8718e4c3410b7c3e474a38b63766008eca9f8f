I"<h3 id="介绍">介绍</h3>

<p>测试右移是DevOps中一项非常重要的工作。随着DevOps的兴起，不仅研发人员需要参与到Ops的工作中去，测试人员也是需要加入进去，参与产品环境中各种测试与质量相关的工作，从而尽可能的保证软件系统在产品环境中的质量，包括正确性，稳定性等。其中产品环境中关于测试与质量相关的工作并不少，但是由于传统的软件开发中，开发和测试人员并不负责产品环境的维护等工作，所以也很少关注产品环境中的质量。导致测试人员只需要负责测试环境的相关测试和质量工作，并把产品环境的测试与质量工作交给了运维人员负责，从而导致当产品环境出现质量问题的时候很难在第一时间发现，甚至需要等很长时间，或者已经造成了大量损失的时候才发现。而测试右移动就是为了尝试解决上面提到的这几个问题，比如在第一时间就发现产品环境的问题，或者缩短问题发现的实践，减少被问题影响到的用户，从而降低损失。</p>

<p>但是由于产品环境的特殊性以及各种限制，导致多种常规类型的测试无法在产品环境实施，比如集成测试，功能测试，性能测试等。所以针对产品环境的自动化测试出现了一些新的方法和类型，比如PVT，A/B 测试，功能有效性监控等。在很多实际的项目中，虽然这些类型的测试现在还在通过手动实施的，但是只要提供相应的测试基础设施和策略，这些测试都是可以进行半自动化或者全自动化测试的。测试技术设施包括测试数据的自动生产和回滚，专用的测试账号，影子流量和影子数据库，不同产品环境和功能开关（Feature Toggle），支持测试的监控系统等。只要拥有这样的基础设施，就可以比较容易的在产品环境中实施自动化测试。但是由于测试右移动的提出并没有多久，理论和实践还没有很好的体系化，所以没有足够成熟和实用的开源框架和工具，而需要基于一些DevOps的相关的基础工具，并集合已有的各种自动化测试框架来实施，比如使用Docker完成不同环境部署，使用相应的数据库工具提供的回滚功能，回归影子数据库，使用Prometheus来完成功能监控等。最后核心的自动化测试工作，仍然需要使用相应的自动化测试框架来开发，从而实现产品环境中的自动化测试。</p>

<p>当一个软件系统开发完毕并交付之后，一般需要发布到特定的产品环境中。对于大部分系统来讲，首先需要确认发布的版本是正确的版本；其次由于测试环境和产品环境存在一定的区别，比如网络环境，配置文件中依赖服务的地址，数据库中针对真实业务的各种参数等。所以当一个软件系统发布并部署到产品环境之后，需要相应的测试和监控实践来确保产品环境中的系统是运行正常并且功能正确的。最为常见的几个实践就是PVT/PAT，系统有效性监控和测试。其中PVT （Production Verification Testing）和PAT（Production Acceptance Testing）是产品环境中最为常用的两类测试，它们属于冒烟测试的，所以它们会包含最为重要的功能测试用例，从而保证这些重要的功能在产品环境中运行正常。一般情况下，这类测试都是专业的测试或者业务人员通过手动进行测试，但是如果产品环境中有专门用于测试的账号和数据，并且在开发阶段实现了相应的自动化测试，则可以直接通过自动化测试对产品环境进行测试。
对于系统功能的有效性监控一般都需要通过测试才能有效的保证，而传统的系统监控只能监控系统的可达性，比如访问系统的某些特定的URL，查看其是否有正常的响应，而不需要真实的登陆之后去执行某些业务功能。这样的监控无法保证系统的功能是否可用，因为有可能系统的服务器是可以正常响应这些特定的URL，但是服务器的业务功能已经不能正常工作了。所以为了真实有效监控系统是否正常工作，一定要监控其业务功能是否正常工作。而监控业务功能是否正常工作最简单和常用的方法就是针对产品环境做相应的功能测试。首先这些功能测试的类型可以是API测试，也可以是UI测试；其次，测试用例一般选取核心功能测试的用例，也可以是Sanity Test的用例；然后基于产品环境自动化运行这些用例，而实施自动化测试可以使用常规的自动化测试技术和方法；最后实时收集并分析测试结果，当产品环境中的系统出现功能相关的问题时，监控系统可以及时的通知运维人员，并且记录下监控和测试日志，可以方便维护人员分析和调试。
只有自动化测试才能最为及时的实现监控的能力，及时的发现系统的问题，所以自动化测试是产品环境中功能有效性监控的必要实践。</p>

<h3 id="小结">小结</h3>

<p>测试右移除了以上这些自动化或者半自动化的测试实践外，还包含一些手动实践实践，比如增加系统的可调式性，自动收集系统出错或者崩溃的信息，进行众测等。通过这些实践可以尽可能的在产品环境中提前发现问题，或者在第一个用户出现问题的同时也发现问题，并通过增加的调试信息尽可能的快速解决，从而防止更多的用户遇到同样的问题。在产品环境中，不管是通过手动测试，半自动化测试还是全自动化测试，其本质和测试环境中的测试是一样的，只不过由于产品环境的特殊性和局限性，导致在测试环境很容易实施的自动化测试，在产品环境中举步维艰。希望通过本章的学习，能帮助读者了解测试右移，并通过相应的实践和工具在产品环境开始实施自动化测试。</p>
:ET